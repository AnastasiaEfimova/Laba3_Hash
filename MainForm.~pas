unit MainForm;

{Задан набор записей следующей структуры: название кинофильма, режиссёр, список актёров,
краткое содержание. По заданному названию фильма найти остальные сведения.}

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ExtCtrls, UMovie, UHashTable, Menus;

type
  THashForm = class(TForm)
    grpInput: TGroupBox;
    edMovieName: TLabeledEdit;
    edProducer: TLabeledEdit;
    edActors: TLabeledEdit;
    edDescription: TLabeledEdit;
    btnAdd: TButton;
    btnFind: TButton;
    mmoOutput: TMemo;
    edFindMovie: TLabeledEdit;
    btnRemove: TButton;
    mmMain: TMainMenu;
    mniFile: TMenuItem;
    mniOpen: TMenuItem;
    mniSave: TMenuItem;
    dlgOpen: TOpenDialog;
    dlgSave: TSaveDialog;
    procedure btnAddClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnFindClick(Sender: TObject);
    procedure btnRemoveClick(Sender: TObject);
    procedure mniOpenClick(Sender: TObject);
    procedure mniSaveClick(Sender: TObject);
  private

  public
    { Public declarations }
  end;

var
  HashForm: THashForm;
  table: THashTable;
implementation

{$R *.dfm}

procedure THashForm.btnAddClick(Sender: TObject);
var
  movie : TMovie;
begin
  if edMovieName.Text = ''  then
    ShowMessage('Введите название фильма')
  else if edProducer.Text = '' then
    ShowMessage('Введите режиссера')
  else if edActors.Text = '' then
    ShowMessage('Введите список актеров')
  else if edDescription.Text = '' then
    ShowMessage('Введите краткое содержание');
  movie:= TMovie.Create();
  movie.Name:= edMovieName.Text;
  movie.Producer:= edProducer.Text;
  movie.Actors:= edActors.Text;
  movie.Description:= edDescription.Text;
  table.add(movie.Name, movie);
  ShowMessage('Фильм добавлен');
end;

procedure THashForm.FormCreate(Sender: TObject);
begin
  table := THashTable.Create;
end;

procedure THashForm.btnFindClick(Sender: TObject);
var
  movie: TMovie;
begin
  if edFindMovie.Text = '' then
    ShowMessage('Введите название фильма')
  else
    begin
      movie := table.get(edFindMovie.Text);
      mmoOutput.Clear;
      if (movie = nil) then
        mmoOutput.Lines.Add('Фильм не найден!')
      else
        begin
          mmoOutput.Lines.Add('Название: ' + movie.Name);
          mmoOutput.Lines.Add('Режиссер: ' + movie.Name);
          mmoOutput.Lines.Add('Актеры: ' + movie.Name);
          mmoOutput.Lines.Add('Краткое содержание: ' + movie.Name);
        end;
    end;
end;


procedure THashForm.btnRemoveClick(Sender: TObject);
begin
  if edFindMovie.Text = '' then
    ShowMessage('Введите название фильма')
  else
    begin
      if table.remove(edFindMovie.Text) then
        ShowMessage('Фильм удален!')
      else
        ShowMessage('Фильм не найден!');
    end;
end;

procedure THashForm.mniOpenClick(Sender: TObject);
var
  loadedCount: integer;
begin
  if dlgOpen.Execute then
    begin
      loadedCount := table.loadFromFile(dlgOpen.FileName);
      if loadedCount > 0 then
        ShowMessage('Loaded '+IntToStr(loadedCount)+' movies')
      else
        ShowMessage('Empty file');
    end;
end;

procedure THashForm.mniSaveClick(Sender: TObject);
begin
  if dlgSave.Execute then
    begin
      table.saveToFile(dlgSave.FileName);
      ShowMessage('Data is saved!');
    end;
end;
end.
